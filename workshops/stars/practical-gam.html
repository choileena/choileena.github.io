<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>My god, it’s full of STARs!   Using Astrology to Enhance Your Results!</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Generalized Additive Models and Beyond">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="My god, it’s full of STARs!   Using Astrology to Enhance Your Results!" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/workshops/stars/" />
  <meta property="og:image" content="https://m-clark.github.io/workshops/stars/img/nineteeneightyR.png" />
  <meta property="og:description" content="Generalized Additive Models and Beyond" />
  <meta name="github-repo" content="m-clark/stars/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="My god, it’s full of STARs!   Using Astrology to Enhance Your Results!" />
  
  <meta name="twitter:description" content="Generalized Additive Models and Beyond" />
  <meta name="twitter:image" content="https://m-clark.github.io/workshops/stars/img/nineteeneightyR.png" />



<meta name="date" content="2017-04-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="building-up-to-gams.html">
<link rel="next" href="issues.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<link href="libs/plotlyjs-1.16.3/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.16.3/plotly-latest.min.js"></script>
<script src="libs/plotly-binding-4.5.6/plotly.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-core-bootstrap-1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="libs/dt-core-bootstrap-1.10.12/css/dataTables.bootstrap.extra.css" rel="stylesheet" />
<script src="libs/dt-core-bootstrap-1.10.12/js/jquery.dataTables.min.js"></script>
<script src="libs/dt-core-bootstrap-1.10.12/js/dataTables.bootstrap.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="standard_html.css" type="text/css" />
<link rel="stylesheet" href="stars.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://m-clark.github.io/workshops/stars/"><span style="font-size:125%; font-variant:small-caps; font-style:italic; color:#ff5503">STARS</span></a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#audience"><i class="fa fa-check"></i>Audience</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#goal"><i class="fa fa-check"></i>Goal</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#workshop-setup"><i class="fa fa-check"></i>Workshop Setup</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#other"><i class="fa fa-check"></i>Other</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="why-not-just-use-standard-methods.html"><a href="why-not-just-use-standard-methods.html"><i class="fa fa-check"></i>Why not just use standard methods?</a><ul>
<li class="chapter" data-level="" data-path="why-not-just-use-standard-methods.html"><a href="why-not-just-use-standard-methods.html#heteroscedasticity-non-normality-etc."><i class="fa fa-check"></i>Heteroscedasticity, non-normality etc.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="polynomial-regression.html"><a href="polynomial-regression.html"><i class="fa fa-check"></i>Polynomial Regression</a><ul>
<li class="chapter" data-level="" data-path="polynomial-regression.html"><a href="polynomial-regression.html#a-more-complex-relationship"><i class="fa fa-check"></i>A more complex relationship</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-up-to-gams.html"><a href="building-up-to-gams.html"><i class="fa fa-check"></i>Building up to GAMs</a><ul>
<li class="chapter" data-level="" data-path="building-up-to-gams.html"><a href="building-up-to-gams.html#piecewise-polynomial"><i class="fa fa-check"></i>Piecewise polynomial</a></li>
<li class="chapter" data-level="" data-path="building-up-to-gams.html"><a href="building-up-to-gams.html#introducing-gams-1"><i class="fa fa-check"></i>Introducing GAMs</a></li>
<li class="chapter" data-level="" data-path="building-up-to-gams.html"><a href="building-up-to-gams.html#polynomial-spline"><i class="fa fa-check"></i>Polynomial spline</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="practical-gam.html"><a href="practical-gam.html"><i class="fa fa-check"></i>Practical GAM</a><ul>
<li class="chapter" data-level="" data-path="practical-gam.html"><a href="practical-gam.html#getting-started"><i class="fa fa-check"></i>Getting started</a></li>
<li class="chapter" data-level="" data-path="practical-gam.html"><a href="practical-gam.html#fitting-the-model"><i class="fa fa-check"></i>Fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="issues.html"><a href="issues.html"><i class="fa fa-check"></i>Issues</a></li>
<li class="chapter" data-level="" data-path="extensions.html"><a href="extensions.html"><i class="fa fa-check"></i>Extensions</a><ul>
<li class="chapter" data-level="" data-path="extensions.html"><a href="extensions.html#extensions-1"><i class="fa fa-check"></i>Extensions</a></li>
<li class="chapter" data-level="" data-path="extensions.html"><a href="extensions.html#connections-generalizations"><i class="fa fa-check"></i>Connections &amp; Generalizations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i>Exercises</a><ul>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="technical-details.html"><a href="technical-details.html"><i class="fa fa-check"></i>Technical details</a><ul>
<li class="chapter" data-level="" data-path="technical-details.html"><a href="technical-details.html#gam-introduction"><i class="fa fa-check"></i>GAM Introduction</a></li>
<li class="chapter" data-level="" data-path="technical-details.html"><a href="technical-details.html#a-detailed-example"><i class="fa fa-check"></i>A detailed example</a></li>
<li class="chapter" data-level="" data-path="technical-details.html"><a href="technical-details.html#the-number-of-knots-and-where-to-put-them."><i class="fa fa-check"></i>The number of knots and where to put them.</a></li>
<li class="chapter" data-level="" data-path="technical-details.html"><a href="technical-details.html#interpreting-output-for-smooth-terms"><i class="fa fa-check"></i>Interpreting output for smooth terms</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://m-clark.github.io" target="blank" style="font-size:150%; font-variant:small-caps; color:#ff5500">Michael Clark</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">My god, it’s full of STARs! <br> <span style="font-size:50%">Using Astrology to Enhance <strong><em>Your</em></strong> Results!</span></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-gam" class="section level1">
<h1>Practical GAM</h1>
<p>One of the more powerful modeling packages in R comes with its installation<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>. The mixed gam computational vehicle, or <span class="pack">mgcv</span> package, is an extremely flexible modeling tool, and one we’ll use for our foray into generalized additive models. If you’re familiar with standard regression models, the syntax is hardly different, but adds a great many possibilities to your modeling efforts.</p>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>So GAMs can be seen as a special type of GLM, that extends the model to incorporate nonlinear and other relationships, but while keeping things within a familiar framework. Behind the scenes, extra columns are added to our model matrix to do this, but their associated coefficients are penalized to help avoid overfitting.</p>
<p>As we will see, the main syntactical difference between using <span class="func">gam</span> and using <span class="func">glm</span> is that you’ll use the <span class="func">s</span> function to incorporate <span class="emph">smooth terms</span>, or classes that include basis functions as we saw before, along with a penalty. Beyond what we did previously, <span class="pack">mgcv</span> also incorporates a penalized regression approach. For those familiar with lasso, ridge or other penalized approaches you’ll find the same idea here. For those new to this, it’s important to add the concept and technique to your statistical modeling toolbox.</p>
<p>Let’s look at some more interesting data than the simulated stuff from before. For the following example we’ll use the iris data set. Just kidding! We’ll look at some data regarding the Internet Movie Database (IMDB) from the <span class="pack">ggplot2movies</span> package. If you want to look at the original, you’ll need to install the package, and the data object within is called <span class="objclass">movies</span>. For for information, type <code>?movies</code> after loading the package.</p>
<p>However, our example will concern yearly averages based on that data set. The primary data set is <code>movies_yearly</code>, with a film budget variable that has been adjusted to 2016 dollars. In addition, I’ve grouped them by whether they are an action movie or not in a separate data set <code>movies_yearly_action</code>. And finally, the data has been filtered to contain only those years where there a decent number of movies to go into the calculations (10 or more for yearly, 5 or more for yearly_action), and feature films (greater than 1 but less than 5 hours).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&#39;data/movies_yearly.RData&#39;</span>)</code></pre></div>
<div id="htmlwidget-4c4d790c7d963cf62893" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c4d790c7d963cf62893">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90"],[1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,24.6880483,14.7964994,17.4815546,17.4413624,14.2796099,10.8254301,17.8574565,19.6042571,20.7022189,9.7282533,9.5125637,18.0407539,17.1148545,17.36328,23.3044686,16.8085046,21.0461238,25.4063052,26.8317283,25.0957987,23.5708383,31.6393053,27.5106617,14.3302478,10.7416502,14.940593,15.1328648,14.3638535,18.0444308,20.6621436,26.9210343,30.100322,32.1274626,25.1178561,24.0342826,21.761006,26.9918036,23.3700244,20.0431479,21.5982939,21.8728531,23.2831069,33.5483832,28.3660282,29.6610441,25.0761005,31.0528188,37.4470501,34.2194816,36.9900846,34.1349556,33.6265517,36.2580243,30.2896183,31.1917586,28.8935894,28.0864231,26.7150302],[6.9,7.3,7.1,7.2,6.6,6.7,6.7,7.2,7.4,7.1,6.8,7.2,7.3,6.3,5.9,6.2,6.2,6.2,6.1,6.2,6.3,6.3,6.3,6.4,6.3,6.3,6.4,6.5,6.3,6.3,6.4,6.5,6.4,6.4,6.3,6.2,6.2,6,5.9,6.2,5.9,5.9,5.8,6,6,5.9,5.9,6,5.9,5.8,5.9,5.8,5.6,5.6,5.6,5.6,5.5,5.5,5.6,5.5,5.5,5.7,5.5,5.5,5.5,5.6,5.6,5.6,5.6,5.6,5.5,5.4,5.4,5.4,5.3,5.6,5.5,5.4,5.3,5.5,5.6,5.3,5.6,5.5,5.7,5.8,6,6,6.2,6.1],[0.1778,0.0205,0.0412,0.0876,0.2139,0.0603,0.3584,0.1116,0.1904,0.3967,0.0629,0.4901,0.1594,0.0543,0.0971,0.1728,0.124,0.1499,0.1008,0.1357,0.1433,0.1577,0.1555,0.415,0.3148,0.3893,0.3639,0.1191,0.1976,0.1846,0.3679,0.1419,0.2115,0.1919,0.2217,0.233,0.209,0.2269,0.3964,0.2676,0.2474,0.291,0.2507,0.387,0.387,0.2572,0.4028,0.31,0.4618,0.2623,0.2781,0.3291,0.4393,0.2376,0.2494,0.4254,0.4594,0.4005,0.4633,0.6037,0.3881,0.5627,0.4617,0.67,0.7425,0.6394,0.7248,0.6699,0.8611,0.8205,0.8625,0.8411,0.8256,0.9154,0.9655,1.0473,1.0382,1.2811,1.4139,1.4929,1.3071,1.5057,1.4691,1.8978,1.5091,1.5268,1.5706,1.32,1.1899,0.5234],[1.39,1.34833333333333,1.29666666666667,1.56166666666667,1.65333333333333,1.60666666666667,1.62833333333333,1.51333333333333,1.685,1.46333333333333,1.57166666666667,1.47166666666667,1.47333333333333,1.44,1.36,1.375,1.325,1.335,1.37166666666667,1.38333333333333,1.41333333333333,1.46,1.43666666666667,1.45333333333333,1.49,1.51,1.46833333333333,1.52166666666667,1.52833333333333,1.51166666666667,1.51833333333333,1.54166666666667,1.53166666666667,1.53333333333333,1.49333333333333,1.49333333333333,1.50833333333333,1.49333333333333,1.52666666666667,1.57833333333333,1.56333333333333,1.52333333333333,1.54666666666667,1.59333333333333,1.635,1.605,1.65833333333333,1.62833333333333,1.62833333333333,1.65333333333333,1.61333333333333,1.63,1.63166666666667,1.65833333333333,1.64833333333333,1.64,1.62166666666667,1.63333333333333,1.62666666666667,1.67833333333333,1.64,1.66833333333333,1.65666666666667,1.66,1.675,1.67,1.64,1.66,1.645,1.63666666666667,1.61666666666667,1.62166666666667,1.63,1.655,1.65833333333333,1.67666666666667,1.67333333333333,1.69,1.66166666666667,1.65666666666667,1.64333333333333,1.64333333333333,1.64,1.655,1.64333333333333,1.65166666666667,1.66,1.65666666666667,1.68,1.67833333333333],[11,14,13,17,24,27,27,27,30,47,58,56,73,124,193,243,262,294,335,309,296,305,299,306,336,341,332,294,283,255,288,327,340,365,372,402,409,430,398,422,402,479,465,436,424,407,448,435,449,423,479,485,546,562,523,567,575,586,568,543,595,564,533,573,613,602,613,628,667,690,719,847,846,842,805,762,800,856,961,1001,1101,1211,1289,1371,1422,1462,1396,1341,1239,263]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> \u003c/th>\n      <th>year\u003c/th>\n      <th>budget_2016\u003c/th>\n      <th>rating\u003c/th>\n      <th>votes\u003c/th>\n      <th>length\u003c/th>\n      <th>N\u003c/th>\n    \u003c/tr>\n  \u003c/thead>\n\u003c/table>","options":{"dom":"pt","scrollX":true,"scrollY":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><br> Let’s examine the the time trend for ratings and budget. Size of the points represents the number of movies that year. <br></p>
<div id="htmlwidget-6b1f5dffcc59efb67ecf" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b1f5dffcc59efb67ecf">{"x":{"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Yearly Trend for Ratings","xaxis":{"domain":[0,1],"title":"Year","showgrid":false,"zeroline":false},"yaxis":{"domain":[0,1],"title":"Average Rating","zeroline":false,"showgrid":false},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud","sendDataToCloud"],"showLink":false,"displaylogo":false},"data":[{"x":[1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],"y":[6.9,7.3,7.1,7.2,6.6,6.7,6.7,7.2,7.4,7.1,6.8,7.2,7.3,6.3,5.9,6.2,6.2,6.2,6.1,6.2,6.3,6.3,6.3,6.4,6.3,6.3,6.4,6.5,6.3,6.3,6.4,6.5,6.4,6.4,6.3,6.2,6.2,6,5.9,6.2,5.9,5.9,5.8,6,6,5.9,5.9,6,5.9,5.8,5.9,5.8,5.6,5.6,5.6,5.6,5.5,5.5,5.6,5.5,5.5,5.7,5.5,5.5,5.5,5.6,5.6,5.6,5.6,5.6,5.5,5.4,5.4,5.4,5.3,5.6,5.5,5.4,5.3,5.5,5.6,5.3,5.6,5.5,5.7,5.8,6,6,6.2,6.1],"type":"scatter","mode":"markers","showlegend":false,"name":"","marker":{"size":[10,10.1860785665059,10.1240523776706,10.3721571330117,10.8063404548587,10.9924190213646,10.9924190213646,10.9924190213646,11.1784975878704,12.2329427980703,12.9152308752584,12.7911784975879,13.8456237077877,17.0089593383873,21.2887663680221,24.3900758097864,25.5685733976568,27.5534114403859,30.0964851826327,28.4838042729152,27.6774638180565,28.2356995175741,27.8635423845624,28.2977257064094,30.158511371468,30.4686423156444,29.9104066161268,27.5534114403859,26.8711233631978,25.1343900758098,27.1812543073742,29.6002756719504,30.4066161268091,31.9572708476912,32.3914541695382,34.2522398345968,34.6864231564438,35.9889731219848,34.0041350792557,35.4927636113025,34.2522398345968,39.0282563749139,38.1598897312198,36.3611302549966,35.6168159889731,34.5623707787733,37.10544452102,36.2991040661613,37.1674707098553,35.5547898001378,39.0282563749139,39.4004135079256,43.184011026878,44.1764300482426,41.7574086836664,44.486560992419,44.9827705031013,45.6650585802895,44.5485871812543,42.9979324603722,46.223294279807,44.3004824259132,42.3776705720193,44.8587181254307,47.3397656788422,46.657477601654,47.3397656788422,48.2701585113715,50.6891798759476,52.1157822191592,53.9145416953825,61.8538938662991,61.7918676774638,61.5437629221227,59.2487939352171,56.5816678152998,58.9386629910407,62.4121295658167,68.9248793935217,71.4059269469331,77.6085458304618,84.4314266023432,89.2694693314955,94.355616815989,97.5189524465886,100,95.9062715368711,92.4948311509304,86.1681598897312,25.6305995864921],"sizemode":"area","fillcolor":"rgba(255,85,3,1)","color":"rgba(255,85,3,1)","line":{"color":"transparent"}},"xaxis":"x","yaxis":"y"},{"x":[1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],"y":[6.9,7.3,7.1,7.2,6.6,6.7,6.7,7.2,7.4,7.1,6.8,7.2,7.3,6.3,5.9,6.2,6.2,6.2,6.1,6.2,6.3,6.3,6.3,6.4,6.3,6.3,6.4,6.5,6.3,6.3,6.4,6.5,6.4,6.4,6.3,6.2,6.2,6,5.9,6.2,5.9,5.9,5.8,6,6,5.9,5.9,6,5.9,5.8,5.9,5.8,5.6,5.6,5.6,5.6,5.5,5.5,5.6,5.5,5.5,5.7,5.5,5.5,5.5,5.6,5.6,5.6,5.6,5.6,5.5,5.4,5.4,5.4,5.3,5.6,5.5,5.4,5.3,5.5,5.6,5.3,5.6,5.5,5.7,5.8,6,6,6.2,6.1],"type":"scatter","mode":"lines","showlegend":false,"line":{"fillcolor":"rgba(255,85,3,1)","color":"rgba(255,85,3,1)"},"xaxis":"x","yaxis":"y"}],"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>For ratings there seems to be a definite curvilinear trend, where initially ratings for movies started high and decreased, but were on the upswing at later years.</p>
<p>Adjusted for inflation, movie budgets don’t increase linearly over time as one might expect, and in fact were decreasing towards the end. Note that we only have <em>adjusted</em> budget data for 1948 on.</p>
<div id="htmlwidget-a75c7899b95b968497e3" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a75c7899b95b968497e3">{"x":{"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Yearly Trend for Budgets","xaxis":{"domain":[0,1],"title":"Year","showgrid":false,"zeroline":false},"yaxis":{"domain":[0,1],"title":"Average Budget in Millions","zeroline":false,"showgrid":false},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud","sendDataToCloud"],"showLink":false,"displaylogo":false},"data":[{"x":[1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],"y":[24.6880483,14.7964994,17.4815546,17.4413624,14.2796099,10.8254301,17.8574565,19.6042571,20.7022189,9.7282533,9.5125637,18.0407539,17.1148545,17.36328,23.3044686,16.8085046,21.0461238,25.4063052,26.8317283,25.0957987,23.5708383,31.6393053,27.5106617,14.3302478,10.7416502,14.940593,15.1328648,14.3638535,18.0444308,20.6621436,26.9210343,30.100322,32.1274626,25.1178561,24.0342826,21.761006,26.9918036,23.3700244,20.0431479,21.5982939,21.8728531,23.2831069,33.5483832,28.3660282,29.6610441,25.0761005,31.0528188,37.4470501,34.2194816,36.9900846,34.1349556,33.6265517,36.2580243,30.2896183,31.1917586,28.8935894,28.0864231,26.7150302],"type":"scatter","mode":"markers","showlegend":false,"name":"","marker":{"size":[15.7798165137615,17.6563803169308,18.1818181818182,20.4336947456214,20.9591326105088,22.535446205171,20.1334445371143,21.9349457881568,20.4336947456214,26.2135112593828,25.162635529608,22.9858215179316,22.0850708924103,20.8090075062552,23.8865721434529,22.9107589658048,23.9616346955797,22.0100083402836,26.2135112593828,26.6638865721435,31.2427022518766,32.4437030859049,29.5162635529608,32.8190158465388,33.419516263553,34.2452043369475,32.8940783986656,31.0175145954962,34.9207673060884,32.5938281901585,30.2668890742285,33.2693911592994,36.2718932443703,35.4462051709758,36.2718932443703,37.3978315262719,40.325271059216,42.0517097581318,44.2285237698082,53.836530442035,53.7614678899083,53.4612176814012,50.6839032527106,47.4562135112594,50.3085904920767,54.512093411176,62.3936613844871,65.396163469558,72.9024186822352,81.1592994161801,87.0141784820684,93.1693077564637,96.9974979149291,100,95.045871559633,90.9174311926606,83.2610508757298,10],"sizemode":"area","fillcolor":"rgba(255,85,3,1)","color":"rgba(255,85,3,1)","line":{"color":"transparent"}},"xaxis":"x","yaxis":"y"},{"x":[1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],"y":[24.6880483,14.7964994,17.4815546,17.4413624,14.2796099,10.8254301,17.8574565,19.6042571,20.7022189,9.7282533,9.5125637,18.0407539,17.1148545,17.36328,23.3044686,16.8085046,21.0461238,25.4063052,26.8317283,25.0957987,23.5708383,31.6393053,27.5106617,14.3302478,10.7416502,14.940593,15.1328648,14.3638535,18.0444308,20.6621436,26.9210343,30.100322,32.1274626,25.1178561,24.0342826,21.761006,26.9918036,23.3700244,20.0431479,21.5982939,21.8728531,23.2831069,33.5483832,28.3660282,29.6610441,25.0761005,31.0528188,37.4470501,34.2194816,36.9900846,34.1349556,33.6265517,36.2580243,30.2896183,31.1917586,28.8935894,28.0864231,26.7150302],"type":"scatter","mode":"lines","showlegend":false,"line":{"fillcolor":"rgba(255,85,3,1)","color":"rgba(255,85,3,1)"},"xaxis":"x","yaxis":"y"}],"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="fitting-the-model" class="section level2">
<h2>Fitting the model</h2>
<p>Let’s fit a GAM to the yearly trend for ratings. I will also put in budget (in millions), movie length (in hours), and number of votes (in thousands) as standard linear effects. We’ll use a cubic regression spline for our basis, <code>bs='cr'</code>, but aside from specifying the smooth term, the syntax is the same as one would use with the <span class="func">glm</span> function. <br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)
gam_model =<span class="st"> </span><span class="kw">gam</span>(rating ~<span class="st"> </span><span class="kw">s</span>(year, <span class="dt">bs=</span><span class="st">&#39;cr&#39;</span>) +<span class="st"> </span>budget_2016 +<span class="st"> </span>votes +<span class="st"> </span>length, 
                <span class="dt">data=</span>movies_yearly)
<span class="kw">summary</span>(gam_model)</code></pre></div>
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
rating ~ s(year, bs = &quot;cr&quot;) + budget_2016 + votes + length

Parametric coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  3.070940   1.130976   2.715  0.00923 **
budget_2016 -0.003215   0.003259  -0.987  0.32888   
votes       -0.050108   0.101998  -0.491  0.62552   
length       1.708533   0.713204   2.396  0.02062 * 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Approximate significance of smooth terms:
          edf Ref.df     F p-value    
s(year) 6.892  7.885 34.94  &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

R-sq.(adj) =  0.899   Deviance explained = 91.6%
GCV = 0.010256  Scale est. = 0.0083302  n = 58</code></pre>
<p>The first part of our output contains standard linear regression results. It is important to note that there is nothing going on here that you haven’t seen in any other GLM. For example, in this case there is no relationship between average budget and rating, whereas there is a positive relationship with average length<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a>.</p>
<table>
<thead>
<tr class="header">
<th align="left"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">t value</th>
<th align="center">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>(Intercept)</strong></td>
<td align="center">3.071</td>
<td align="center">1.131</td>
<td align="center">2.715</td>
<td align="center">0.009</td>
</tr>
<tr class="even">
<td align="left"><strong>budget_2016</strong></td>
<td align="center">-0.003</td>
<td align="center">0.003</td>
<td align="center">-0.987</td>
<td align="center">0.329</td>
</tr>
<tr class="odd">
<td align="left"><strong>votes</strong></td>
<td align="center">-0.050</td>
<td align="center">0.102</td>
<td align="center">-0.491</td>
<td align="center">0.626</td>
</tr>
<tr class="even">
<td align="left"><strong>length</strong></td>
<td align="center">1.709</td>
<td align="center">0.713</td>
<td align="center">2.396</td>
<td align="center">0.021</td>
</tr>
</tbody>
</table>
<p>The next part contains our information regarding the smooth terms, of which there is only one.</p>
<table>
<thead>
<tr class="header">
<th align="left"> </th>
<th align="center">edf</th>
<th align="center">Ref.df</th>
<th align="center">F</th>
<th align="center">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>s(year)</strong></td>
<td align="center">6.892</td>
<td align="center">7.885</td>
<td align="center">34.943</td>
<td align="center">0.000</td>
</tr>
</tbody>
</table>
<p>While this suggests a statistically significant effect, it’s important to note there is not a precisely defined p-value in this setting- it clearly states ‘approximate significance’. For some more details see the <a href="technical-details.html#interpreting-output-for-smooth-terms">technical section</a> or <a href="https://m-clark.github.io/docs/GAM.html">my document</a>, but we’ll briefly talk about the <span class="emph">effective degrees of freedom</span>, or edf. In typical OLS regression the model degrees of freedom is equivalent to the number of predictors/terms in the model. This is not so straightforward with a GAM due to the smoothing process and the penalized regression estimation procedure. In this example there are actually 9 terms associated with this smooth, but they are each penalized to some extent and thus the <em>effective</em> degrees of freedom does not equal 9. For hypothesis testing an alternate edf is actually used, which is the other one provided there in the summary result (Ref.df).</p>
<p>The thing to keep in mind is that the edf would equal 1 if the model penalized the smooth term to a simple linear relationship<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a>, and so the effective degrees of freedom falls somewhere between 1 and k-1, where k is chosen based on the basis. You can think of it as akin to the number of knots. The default here was 10. Basically if it’s 1, just leave it as a linear component, or if it’s close to k, maybe bump up the default to allow for more wiggliness.</p>
<div id="visualizing-the-effects" class="section level3">
<h3>Visualizing the effects</h3>
<p>While the statistical result is helpful to some extent, the best way to interpret smooth terms is visually. The ability to do so is easy, you can just use the <span class="func">plot</span> method on the model object. However, the default plot may be difficult to grasp at first. It is a <a href="https://en.wikipedia.org/wiki/Partial_residual_plot#CCPR_plot">component plot</a>, which plots the original variable against the linear combination of its basis functions, i.e. the sum of each basis function multiplied by its respective coefficient. For example, if we were using a quadratic polynomial, it would be the plot of <span class="math inline">\(x\)</span> against <span class="math inline">\(b_1\cdot x + b_2\cdot x^2\)</span>. For GAMs, <span class="math inline">\(y\)</span> is also centered, and what you end up with is something like the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(gam_model)</code></pre></div>
<p><img src="stars_files/figure-html/gamplot-1.svg" width="768" style="display: block; margin: auto;" /></p>
<p>So this tells us the contribution of the year to the model fit<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a>.</p>
<p>For an alternative, consider the <span class="pack">visreg</span> package, which focuses on standard predicted values holding other variables constant, and it just looks slightly nicer by default while allowing for more control.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(visreg)
<span class="kw">visreg</span>(gam_model, <span class="dt">xvar=</span><span class="st">&#39;year&#39;</span>, <span class="dt">partial=</span>F)</code></pre></div>
<p><img src="stars_files/figure-html/visreg-1.svg" width="768" style="display: block; margin: auto;" /></p>
<p>You of course can look at predictions at any relevant values for the covariates, as you can with any other model. Consider the following effect of time while keeping budget and length constant at their means, and votes at 1000<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies_yearly %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">na.omit</span>() %&gt;%
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">budget_2016 =</span> <span class="kw">mean</span>(budget_2016),
            <span class="dt">length =</span> <span class="kw">mean</span>(length),
            <span class="dt">votes =</span> <span class="dv">1</span>,
            <span class="dt">year=</span>year) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">add_predictions</span>(gam_model, <span class="dt">var=</span><span class="st">&#39;Predicted_Rating&#39;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">plot_ly</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">add_lines</span>(~year, ~Predicted_Rating)</code></pre></div>
<div id="htmlwidget-ddd42954edeca2ca920a" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-ddd42954edeca2ca920a">{"x":{"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"title":"year"},"yaxis":{"domain":[0,1],"title":"Predicted_Rating"}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},"data":[{"x":[1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],"y":[6.56249301377554,6.4839409690195,6.40672694701548,6.33218897051553,6.26166506227166,6.19649324503591,6.1380115415603,6.08742165581903,6.04434058599385,6.00736293943273,5.97506628363636,5.94602818610548,5.91882621434079,5.89204299551441,5.86456473708161,5.83574819593666,5.80499060634485,5.77168920257153,5.73524121888202,5.69504388954165,5.65104377329009,5.60538472676442,5.56075993107608,5.5198625673365,5.4853858166571,5.46002286014933,5.44619954325168,5.44323393420482,5.44843908370246,5.45909462547916,5.47248019326951,5.48587542080808,5.49657675874691,5.50288967278478,5.50468360194304,5.50196252058258,5.49473040306429,5.48299122374906,5.4667489569978,5.4464586872073,5.42437993891793,5.40322334670599,5.38569954514773,5.37451916881946,5.37239285229745,5.38184258766163,5.40319739797212,5.43537148756651,5.47725548047037,5.52774000070925,5.58571567230874,5.65007446808233,5.71978928812043,5.79395846979264,5.87169114077214,5.9520964287321,6.03428346134571,6.11736136628614],"type":"scatter","mode":"lines","line":{"fillcolor":"rgba(31,119,180,1)","color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y"}],"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>See the <a href="technical-details.html#visual-depiction">technical details</a> on how to reproduce both the <span class="pack">mgcv</span> and <span class="pack">visreg</span> default plots. In the end, controlling for budget, length, and popularity, movie quality decreased notably until the 70s, and remained at that level until the late 90s, when quality increased even more dramatically.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>For reasons I’ve not understood, other packages still depend on or extend the <span class="pack">gam</span> package, which doesn’t possess anywhere near the functionality (though the authors literally wrote the book on GAM), or even the <span class="pack">splines</span> package, which comes with base R but has even less. If you’re going to use additive models, I suggest starting with <span class="pack">mgcv</span> until you know it cannot do what you want, then consider the <a href="https://www.r-pkg.org/search.html?q=mgcv">extensions</a> to it that are out there.<a href="practical-gam.html#fnref5">↩</a></p></li>
<li id="fn6"><p>Presumably we have to justify the time spent watching longer movies. But remember these are averages, so bumping up the <em>average length</em> for a given year would undoubtedly fundamentally change the types of movies considered.<a href="practical-gam.html#fnref6">↩</a></p></li>
<li id="fn7"><p>You can actually penalize the covariate right out of the model if desired, i.e. edf=0.<a href="practical-gam.html#fnref7">↩</a></p></li>
<li id="fn8"><p>This is the same as what the base R function <span class="func">termplot</span> would provide for a standard (g)lm. You can request the plots be applied to the non-smooth terms in the model as well. And the residuals function has an argument, <code>type='partial'</code> that can be applied to produce the partial residuals, which are the <code>residuals + term</code>. See <code>?termplot</code> for more info, and the <a href="technical-details.html#visual-depiction">technical details section</a>. Note that in the case of a single smooth term and nothing else in the model, one could add the intercept to get back to the response scale. However, the visreg approach would be the way to go in that case, as it extends to easy set values for other covariates as well.<a href="practical-gam.html#fnref8">↩</a></p></li>
<li id="fn9"><p>If we had put votes at its median, you would basically duplicate the previous plot.<a href="practical-gam.html#fnref9">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="building-up-to-gams.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="issues.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "san-serif",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05_gam2.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
},
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
