<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Choi Lab: Build-PK-IV - Comprehensive</title>
  
  <meta property="description" itemprop="description" content="This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (*Pro-Demographic*, *Pro-Med-Str*, *Pro-Drug Level*, *Pro-Laboratory*) and data building which creates the final PK data (*Build-PK-IV*)."/>
  
  
  <meta name="article:author" content="Nathan T. James"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Choi Lab: Build-PK-IV - Comprehensive"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (*Pro-Demographic*, *Pro-Med-Str*, *Pro-Drug Level*, *Pro-Laboratory*) and data building which creates the final PK data (*Build-PK-IV*)."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Choi Lab"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Choi Lab: Build-PK-IV - Comprehensive"/>
  <meta property="twitter:description" content="This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (*Pro-Demographic*, *Pro-Med-Str*, *Pro-Drug Level*, *Pro-Laboratory*) and data building which creates the final PK data (*Build-PK-IV*)."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","output"]}},"value":[{"type":"character","attributes":{},"value":["Build-PK-IV - Comprehensive"]},{"type":"character","attributes":{},"value":["This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (*Pro-Demographic*, *Pro-Med-Str*, *Pro-Drug Level*, *Pro-Laboratory*) and data building which creates the final PK data (*Build-PK-IV*).\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Nathan T. James"]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[2]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }
  
  </style>
  
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>
  
  <script type="application/javascript">
  
  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }
  
  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }
  
  function createFuseIndex() {
  
    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);
  
    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });
  
        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }
  
  window.document.addEventListener("DOMContentLoaded", function (event) {
  
    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;
  
    createFuseIndex()
      .then(function(fuse) {
  
        // make search box visible
        searchEl.classList.remove('hidden');
  
        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });
  
  });
  
  </script>
  
  <style type="text/css">
  
  .nav-search {
    font-size: x-small;
  }
  
  /* Algolioa Autocomplete */
  
  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }
  
  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }
  
  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }
  
  </style>
  
  
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  /* Citation hover box */
  
  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }
  
  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-728B0KW1HX"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-728B0KW1HX');
  </script>
  <style type="text/css">
  img.rhs100 {
    float: right;
    width: 100px;
    padding-left: 1em;
  }
  
  img.lhs100 {
    float: left;
    width: 100px;
    padding-left: 2em;
  }
  
  figure.rhs {
    float: right;
    width: 570px;
    padding-left: 1em;
  }
  
  @media(min-width: 768px) {
  
  d-article {
    font-size: 1.1rem;
    line-height: 1.3em;
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 3fr 3fr 3fr 3fr 3fr 3fr 3fr 3fr [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
  }
  }
  
  pre.sourceCode {
    background-color: #D4E6FC;
  }
  
  d-article h1 {
    font-size: 30px;
  }
  
  d-article h2 {
    font-size: 25px;
  }
  
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Build-PK-IV - Comprehensive","description":"This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (*Pro-Demographic*, *Pro-Med-Str*, *Pro-Drug Level*, *Pro-Laboratory*) and data building which creates the final PK data (*Build-PK-IV*).","authors":[{"author":"Nathan T. James","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">Choi Lab</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Workshops
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="workshops.html">All Workshops</a>
<a href="Extract-Med.html">Extract-Med</a>
<a href="Pro-Med-NLP.html">Pro-Med-NLP</a>
<a href="Pro-Demographic.html">Pro-Demographic</a>
<a href="Pro-DrugLevel.html">Pro-Drug Level</a>
<a href="Pro-Laboratory.html">Pro-Laboratory</a>
<a href="Pro-Med-Str-Part1.html">Pro-Med-Str : Part I</a>
<a href="Pro-Med-Str-Part2.html">Pro-Med-Str : Part II</a>
<a href="Build-PK-Oral.html">Build-PK-Oral</a>
<a href="Build-PK-IV-simple.html">Build-PK-IV : Simple</a>
<a href="Build-PK-IV-comprehensive.html">Build-PK-IV : Comprehensive</a>
<a href="PK-Data-Oral-Dosing.html">PK Data for Oral Dosing</a>
<a href="PK-Data-IV-Dosing.html">PK Data for IV Dosing</a>
</div>
</div>
<a href="about.html">About</a>
<a href="https://github.com/choileena/choileena.github.io" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Build-PK-IV - Comprehensive</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>This tutorial describes a comprehensive PK data building procedure for medications that are intravenously administered. There are two phases: data processing which standardizes and combines the input data (<em>Pro-Demographic</em>, <em>Pro-Med-Str</em>, <em>Pro-Drug Level</em>, <em>Pro-Laboratory</em>) and data building which creates the final PK data (<em>Build-PK-IV</em>).</p></p>
</div>

<div class="d-byline">
  Nathan T. James  
  

</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#pre-processing-for-raw-extracted-data">Pre-Processing for Raw Extracted Data</a><ul>
<li><a href="#read-and-clean-raw-data">(1) Read and clean raw data</a></li>
<li><a href="#merge-data-to-create-new-id-variables">(2) Merge data to create new ID variables</a></li>
<li><a href="#make-new-data-for-use-with-modules">(3) Make new data for use with modules</a></li>
</ul></li>
<li><a href="#pro-demographic">Pro-Demographic</a></li>
<li><a href="#pro-med-str-part-i-iv-dose-data">Pro-Med-Str Part I: IV dose data</a></li>
<li><a href="#pro-drug-level">Pro-Drug Level</a></li>
<li><a href="#pro-laboratory">Pro-Laboratory</a></li>
<li><a href="#build-pk-iv">Build-PK-IV</a></li>
<li><a href="#references">References</a></li>
</ul>
</nav>
</div>
<ul>
<li>See also “Example 2: Complete Data Processing and Building from Raw Extracted Data to PK Data” in “<a href="https://cran.r-project.org/web/packages/EHR/vignettes/ehr_vignette_02_str.html">2. EHR Vignette for Structured Data</a>” of <code>EHR</code> package.</li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>This tutorial describes four modules for processing data (<em>Pro-Demographic</em>, <em>Pro-Med-Str</em>, <em>Pro-Drug Level</em>, <em>Pro-Laboratory</em>) and one module for PK data building (<em>Build-PK-IV</em>) using data extracted from a structured database.</p>
<p>To begin we load the <code>EHR</code> package, the <code>pkdata</code> package, and the <code>lubridate</code> package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># load EHR package and dependencies</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://choileena.github.io/'>EHR</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>pkdata</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p>We first define three directories:</p>
<ul>
<li>one for raw structured data</li>
<li>one containing files used for interactive checking</li>
<li>one for processed data.</li>
</ul></li>
<li><p>There are 4 types of raw data expected to exist in the raw data directory (i.e., rawDataDir below):</p>
<ul>
<li>a demographic file for use with the <em>Pro-Demographic</em> module (Demographics_DATA.csv)</li>
<li>two files for the <em>Pro-Drug Level</em> module (SampleTimes_DATA.csv and SampleConcentration_DATA.csv)</li>
<li>two dosing files for the <em>Pro-Med-Str</em> module (FLOW_DATA.csv and MAR_DATA.csv)</li>
<li>two lab files for use with the <em>Pro-Laboratory</em> module (Creatinine_DATA.csv and Albumin_DATA.csv).</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># define 3 directories</span>
<span class='va'>rawDataDir</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"examples"</span>, <span class='st'>"str_ex2"</span>, package<span class='op'>=</span><span class='st'>"EHR"</span><span class='op'>)</span> <span class='co'># directory for raw data</span>

<span class='va'>td</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>checkDir</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>'checks'</span><span class='op'>)</span> <span class='co'># directory for interactive checking</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='va'>checkDir</span><span class='op'>)</span>

<span class='va'>dataDir</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>'data'</span><span class='op'>)</span> <span class='co'># directory for processed data</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='va'>dataDir</span><span class='op'>)</span>

<span class='co'># examine raw data files in rawDataDir</span>
<span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>dir</a></span><span class='op'>(</span><span class='va'>rawDataDir</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Albumin_DATA.csv&quot;             &quot;Creatinine_DATA.csv&quot;          &quot;Demographics_DATA.csv&quot;        &quot;e-rx_DATA.csv&quot;               
[5] &quot;FLOW_DATA.csv&quot;                &quot;MAR_DATA.csv&quot;                 &quot;medChecked-fent.csv&quot;          &quot;SampleConcentration_DATA.csv&quot;
[9] &quot;SampleTimes_DATA.csv&quot;        </code></pre>
</div>
<h1 id="pre-processing-for-raw-extracted-data">Pre-Processing for Raw Extracted Data</h1>
<p>The raw datasets must go through a pre-processing stage which creates new ID variables and datasets that can be used by the data processing modules. There are three pre-processing steps:</p>
<ol type="1">
<li>read and clean raw data</li>
<li>merge raw data to create new ID variables</li>
<li>make new data for use with modules.</li>
</ol>
<p>Each raw dataset should contain a subject unique ID, a subject visit ID, or both ids. In this example the subject unique ID is called <code>subject_uid</code> and the subject visit ID is called <code>subject_id</code>. The subject visit ID is a combination of subject and visit/course – e.g., <code>subject_id</code> 14.0 is the first course for subject 14, <code>subject_id</code> 14.1 is the second course for subject 14, and so on. <code>subject_uid</code> is a unique ID that is the same for all subject records. The integer part of <code>subject_id</code> has a 1-to-1 correspondence with <code>subject_uid</code> – for this example, <code>subject_uid</code> 62734832 is associated with both <code>subject_id</code> 14.0 and <code>subject_id</code> 14.1. If there is only a single visit/course per subject only the subject unique ID is needed.</p>
<h2 id="read-and-clean-raw-data">(1) Read and clean raw data</h2>
<ul>
<li><p><strong><code>readTransform()</code></strong>: This function reads in a CSV file and makes optional modifications to the resulting dataframe.</p></li>
<li><p><strong>Demographics raw data</strong></p>
<ul>
<li>The example demographics data file contains ID variables <code>subject_id</code> and <code>subject_uid</code>, in addition to demographic variables such as gender, date of birth, height, weight, etc. As <code>subject_id</code> and <code>subject_uid</code> already exist, no further cleaning is needed.</li>
<li>The Demographics_DATA.csv file is read in using the <code>readTransform()</code> function.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># demographics data</span>
<span class='va'>demo.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"Demographics_DATA.csv"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>demo.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_id subject_uid gender weight height surgery_date ageatsurgery stat_sts cpb_sts in_hospital_mortality add_ecmo date_icu_dc
1       1106    34364670      0   5.14  59.18    6/28/2014          141        3     133                     0        0    7/2/2014
2       1444    36792472      1   5.67  62.90    1/10/2016          292        1      65                     0        0   1/12/2016
3       1465    36292449      0  23.67 118.02    3/19/2016         2591        2     357                     0        0   3/20/2016
4       1520    34161967      0  14.07  97.04    7/18/2016         1320        5      93                     0        0   7/19/2016
5       1524    37857374      1  23.40 102.80    7/23/2016         1561        3      87                     1        0   7/30/2016
6       1550    37826262      1   6.21  62.03     9/4/2016          208        1     203                     0        0   9/11/2016
  time_fromor
1        1657
2        1325
3          NA
4        1745
5        1847
6        1210</code></pre>
</div>
<ul>
<li><strong>Concentration raw data</strong>
<ul>
<li>The example concentration data consists of two files:
<ul>
<li><ol type="1">
<li>SampleTimes_DATA.csv: contains the concentration sampling times</li>
</ol></li>
<li><ol start="2" type="1">
<li>SampleConcentration_DATA.csv: contains the concentration measurements</li>
</ol></li>
</ul></li>
<li>If all concentration data is in one file, the user should transform the file so it contains a subject unique ID, a subject visit ID, or both ids.</li>
<li>Use the function <code>readTransform()</code>
<ul>
<li>to read SampleTimes_DATA.csv, and rename the variable <code>Study.ID</code> to <code>subject_id</code> and create a new variable called <code>samp</code>, which indexes the sample number, using the <code>modify=</code> argument.</li>
<li>to read SampleConcentration_DATA.csv, and transform the concentration values - we use the helper function sampId() to process the subject_id field.</li>
</ul></li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># read SampleTimes_DATA.csv</span>
<span class='va'>samp.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"SampleTimes_DATA.csv"</span><span class='op'>)</span>,
    rename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Study.ID'</span> <span class='op'>=</span> <span class='st'>'subject_id'</span><span class='op'>)</span>,
    modify <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>samp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>'Sample '</span>, <span class='st'>''</span>, <span class='va'>Event.Name</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>samp.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_id Event.Name Sample.Collection.Date.and.Time samp
1      466.1   Sample 1                  2/3/2017 10:46    1
2      466.1   Sample 2                  2/4/2017 20:30    2
3     1106.0   Sample 1                 6/28/2014 13:40    1
4     1106.0   Sample 2                 6/29/2014 03:10    2
5     1106.0   Sample 3                 6/30/2014 03:35    3
6     1106.0   Sample 4                  7/1/2014 03:45    4</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># helper function used to make subject_id</span>
<span class='va'>sampId</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># remove leading zeroes or trailing periods</span>
  <span class='va'>subid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>'(^0*|\\.$)'</span>, <span class='st'>''</span>, <span class='va'>x</span><span class='op'>)</span>
  <span class='co'># change _ to .</span>
  <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>'_([0-9]+[_].*)$'</span>, <span class='st'>'.\\1'</span>, <span class='va'>subid</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># read SampleConcentration_DATA.csv</span>
<span class='va'>conc.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"SampleConcentration_DATA.csv"</span><span class='op'>)</span>,
  modify <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    subid <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'>sampId</span><span class='op'>(</span><span class='va'>name</span><span class='op'>)</span><span class='op'>)</span>,
    subject_id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>'[_].*'</span>, <span class='st'>''</span>, <span class='va'>subid</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    samp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>'[^_]*[_]'</span>, <span class='st'>''</span>, <span class='va'>subid</span><span class='op'>)</span><span class='op'>)</span>,
    name <span class='op'>=</span> <span class='cn'>NULL</span>,
    data_file <span class='op'>=</span> <span class='cn'>NULL</span>,
    subid <span class='op'>=</span> <span class='cn'>NULL</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>conc.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  record_id fentanyl_calc_conc subject_id samp
1         1         0.01413622      466.1    1
2         2         0.27982075      466.1    2
3         3         6.11873679     1106.0    1
4         4         0.59161716     1106.0    2
5         5         0.11280471     1106.0    3
6         6         0.02112153     1106.0    4</code></pre>
</div>
<ul>
<li><strong>Dosing raw data</strong>
<ul>
<li>The example drug dosing data consists of two files containing two sources of IV dose information:
<ul>
<li><ol type="1">
<li>FLOW_DATA.csv: contains aliases for both ID variables, and it is read in with the <code>readTransform()</code> function which renames the variables <code>Subject.Id</code> to <code>subject_id</code> and <code>Subject.Uniq.Id</code> to <code>subject_uid</code>.</li>
</ol></li>
<li><ol start="2" type="1">
<li>MAR_DATA.csv: contains several variables with a colon (:) character. To preserve the colon in these variable names, the data can be read in without checking for syntactically valid <code>R</code> variable names. The data is read in using <code>read.csv()</code> with the argument <code>check.names = FALSE</code> and then passed to the <strong><code>dataTransformation()</code></strong> function which renames <code>Uniq.Id</code> to <code>subject_uid</code>.</li>
</ol></li>
</ul></li>
<li>If all dosing data is in one file, the user should transform the file so it contains a subject unique ID, a subject visit ID, or both ids.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># FLOW dosing data</span>
<span class='va'>flow.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"FLOW_DATA.csv"</span><span class='op'>)</span>,
                         rename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Subject.Id'</span> <span class='op'>=</span> <span class='st'>'subject_id'</span>,
                                    <span class='st'>'Subject.Uniq.Id'</span> <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span><span class='op'>)</span> 
<span class='co'># pre-process the flow data </span>
<span class='co'># date.time variable should be in an appropriate form</span>
<span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'date.time'</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>pkdata</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pkdata/man/parse_dates.html'>parse_dates</a></span><span class='op'>(</span><span class='fu'>EHR</span><span class='fu'>:::</span><span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pk-internal.html'>fixDates</a></span><span class='op'>(</span><span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'Perform.Date'</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># unit and rate are required: separate unit and rate from 'Final.Rate..NFR.units.' if needed</span>
<span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'unit'</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>'.*[ ]'</span>, <span class='st'>''</span>, <span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'Final.Rate..NFR.units.'</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'rate'</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>'([0-9.]+).*'</span>, <span class='st'>'\\1'</span>, <span class='va'>flow.in</span><span class='op'>[</span>,<span class='st'>'Final.Rate..NFR.units.'</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>flow.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_id subject_uid     Perform.Date FOCUS_MEDNAME Final.Wt..kg. Final.Rate..NFR.units. Final.Units Flow           date.time      unit
1       1596    38340814   12/4/2016 5:30      Fentanyl          6.75            1 mcg/kg/hr       3.375   NA 2016-12-04 05:30:00 mcg/kg/hr
2       1596    38340814   12/4/2016 6:00      Fentanyl          6.75            1 mcg/kg/hr       6.750  0.1 2016-12-04 06:00:00 mcg/kg/hr
3       1596    38340814   12/4/2016 7:00      Fentanyl          6.75            1 mcg/kg/hr       4.500  0.1 2016-12-04 07:00:00 mcg/kg/hr
4       1596    38340814   12/4/2016 7:40      Fentanyl          6.75            0 mcg/kg/hr       0.000   NA 2016-12-04 07:40:00 mcg/kg/hr
5       1607    38551767 12/24/2016 19:30      Fentanyl          2.60            2 mcg/kg/hr       2.600   NA 2016-12-24 19:30:00 mcg/kg/hr
6       1607    38551767 12/24/2016 20:00      Fentanyl          2.60            2 mcg/kg/hr       5.200  0.2 2016-12-24 20:00:00 mcg/kg/hr
  rate
1    1
2    1
3    1
4    0
5    2
6    2</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># MAR dosing data</span>
<span class='va'>mar.in0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"MAR_DATA.csv"</span><span class='op'>)</span>, check.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>mar.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/dataTransformation.html'>dataTransformation</a></span><span class='op'>(</span><span class='va'>mar.in0</span>, rename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Uniq.Id'</span> <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>mar.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_uid       Date  Time                 med:mDrug   med:dosage med:route med:freq med:given
1    28579217 2017-02-04 19:15               Nicardipine 3 mcg/kg/min        IV     &lt;NA&gt;     Given
2    28579217 2011-10-02 22:11                Famotidine       4.5 mg        IV   q12hrs     Given
3    28579217 2011-10-02 20:17          Morphine sulfate         1 mg        IV  q2h prn     Given
4    28579217 2011-10-03 02:28 Diphenhydramine injection        12 mg        IV      now     Given
5    28579217 2011-10-02 22:11                 Cefazolin       225 mg        IV    q8hrs     Given
6    28579217 2011-10-02 23:30          Morphine sulfate         1 mg        IV  q2h prn     Given</code></pre>
</div>
<ul>
<li><strong>Laboratory raw data</strong>
<ul>
<li>The example laboratory data consists of files two files, Creatinine_DATA.csv and Albumin_DATA.csv. Both files are read in using the <code>readTransform()</code> function and <code>Subject.uniq</code> is renamed to <code>subject_uid</code>.</li>
<li>Each laboratory file should be transformed so it contains a subject unique ID, a subject visit ID, or both ids.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Serum creatinine lab data</span>
<span class='va'>creat.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"Creatinine_DATA.csv"</span><span class='op'>)</span>,
    rename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Subject.uniq'</span> <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>creat.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_uid     date time creat
1    28579217 02/05/17 4:00  0.52
2    28579217 02/06/17 5:00  0.53
3    28579217 10/03/11 4:28  0.42
4    28579217 10/04/11 4:15  0.35
5    28579217 10/06/11 4:25  0.29
6    28579217 10/09/11 4:45  0.28</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Albumin lab data</span>
<span class='va'>alb.in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/readTransform.html'>readTransform</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>rawDataDir</span>, <span class='st'>"Albumin_DATA.csv"</span><span class='op'>)</span>,
    rename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Subject.uniq'</span> <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>creat.in</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_uid     date time creat
1    28579217 02/05/17 4:00  0.52
2    28579217 02/06/17 5:00  0.53
3    28579217 10/03/11 4:28  0.42
4    28579217 10/04/11 4:15  0.35
5    28579217 10/06/11 4:25  0.29
6    28579217 10/09/11 4:45  0.28</code></pre>
</div>
<h2 id="merge-data-to-create-new-id-variables">(2) Merge data to create new ID variables</h2>
<ul>
<li><strong><code>idCrosswalk()</code></strong>: This function merges all of the cleaned input datasets and creates new IDs.
<ul>
<li>Input:
<ul>
<li>the <code>data=</code> argument of this function accepts a list of input datasets</li>
<li>the <code>idcols=</code> argument accepts a list of vectors or character strings that identify the ID variables in the corresponding input dataset.</li>
</ul></li>
<li>Output:
<ul>
<li>a crosswalk dataset between the original ID variables (<code>subject_id</code>, <code>subject_uid</code>) and the new ID variables (<code>mod_id</code>, <code>mod_visit</code>, and <code>mod_id_visit</code>).</li>
<li>the new variable <code>mod_id_visit</code> has a 1-to-1 correspondence to variable <code>subject_id</code> and uniquely identifies each subjects’ visit/course; the new variable <code>mod_id</code> has a 1-to-1 correspondence to variable <code>subject_uid</code> and uniquely identifies each subject.</li>
</ul></li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># define list of input datasets</span>
<span class='va'>data</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>demo.in</span>,
              <span class='va'>samp.in</span>,
              <span class='va'>conc.in</span>,
              <span class='va'>flow.in</span>,
              <span class='va'>mar.in</span>,
              <span class='va'>creat.in</span>,
              <span class='va'>alb.in</span><span class='op'>)</span>

<span class='co'># define list of vectors or character strings that identify the ID variables</span>
<span class='va'>idcols</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'subject_id'</span>, <span class='st'>'subject_uid'</span><span class='op'>)</span>, <span class='co'># id vars in demo.in</span>
                <span class='st'>'subject_id'</span>, <span class='co'># id var in samp.in</span>
                <span class='st'>'subject_id'</span>, <span class='co'># id var in conc.in</span>
                <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'subject_id'</span>, <span class='st'>'subject_uid'</span><span class='op'>)</span>, <span class='co'># id vars in flow.in</span>
                <span class='st'>'subject_uid'</span>, <span class='co'># id var in mar.in</span>
                <span class='st'>'subject_uid'</span>, <span class='co'># id var in creat.in</span>
                <span class='st'>'subject_uid'</span><span class='op'>)</span> <span class='co'># id var in creat.in</span>

<span class='co'># merge all IDs from cleaned datasets and create new ID variables</span>
<span class='va'>id.xwalk</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/idCrosswalk.html'>idCrosswalk</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>idcols</span>, visit.id<span class='op'>=</span><span class='st'>"subject_id"</span>, uniq.id<span class='op'>=</span><span class='st'>"subject_uid"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>id.xwalk</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"module_id_xwalk.rds"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>id.xwalk</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_id subject_uid mod_visit mod_id mod_id_visit
1      466.0    28579217         1      1          1.1
2      466.1    28579217         2      1          1.2
3     1106.0    34364670         1      2          2.1
4     1444.0    36792472         1      3          3.1
5     1465.0    36292449         1      4          4.1
6     1520.0    34161967         1      5          5.1</code></pre>
</div>
<h2 id="make-new-data-for-use-with-modules">(3) Make new data for use with modules</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>dat</span>, <span class='va'>xwalk</span>, firstCols <span class='op'>=</span> <span class='cn'>NULL</span>, orderBy <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><strong><code>pullFakeId()</code></strong>: This function replaces the original IDs – <code>subject_id</code> and <code>subject_uid</code> – with new IDs – <code>mod_id</code>, <code>mod_visit</code>, and <code>mod_id_visit</code> – to create datasets which can be used by the data processing modules.
<ul>
<li>The <code>dat=</code> argument should contain the cleaned input data.frame from pre-processing step (1).</li>
<li>The <code>xwalk=</code> argument should contain the crosswalk data.frame produced in step (2).</li>
<li>Additional arguments <code>firstCols=</code> and <code>orderBy=</code> control which variables are in the first columns of the output and the sort order, respectively.</li>
<li>The cleaned, structured data are saved as <code>R</code> objects for use with the modules.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## demographics data</span>
<span class='va'>demo.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>demo.in</span>, <span class='va'>id.xwalk</span>,
    firstCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>, <span class='st'>'mod_visit'</span>, <span class='st'>'mod_id_visit'</span><span class='op'>)</span>,
    uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>demo.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id mod_visit mod_id_visit gender weight height surgery_date ageatsurgery stat_sts cpb_sts in_hospital_mortality add_ecmo date_icu_dc
1      2         1          2.1      0   5.14  59.18    6/28/2014          141        3     133                     0        0    7/2/2014
2      3         1          3.1      1   5.67  62.90    1/10/2016          292        1      65                     0        0   1/12/2016
3      4         1          4.1      0  23.67 118.02    3/19/2016         2591        2     357                     0        0   3/20/2016
4      5         1          5.1      0  14.07  97.04    7/18/2016         1320        5      93                     0        0   7/19/2016
5      6         1          6.1      1  23.40 102.80    7/23/2016         1561        3      87                     1        0   7/30/2016
6      7         1          7.1      1   6.21  62.03     9/4/2016          208        1     203                     0        0   9/11/2016
  time_fromor
1        1657
2        1325
3          NA
4        1745
5        1847
6        1210</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>demo.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"demo_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## drug level data</span>
<span class='co'># sampling times</span>
<span class='va'>samp.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>samp.in</span>, <span class='va'>id.xwalk</span>,
    firstCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>, <span class='st'>'mod_visit'</span>, <span class='st'>'mod_id_visit'</span>, <span class='st'>'samp'</span><span class='op'>)</span>, 
    orderBy <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id_visit'</span>,<span class='st'>'samp'</span><span class='op'>)</span>,
    uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>samp.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id mod_visit mod_id_visit samp Event.Name Sample.Collection.Date.and.Time
1      1         2          1.2    1   Sample 1                  2/3/2017 10:46
2      1         2          1.2    2   Sample 2                  2/4/2017 20:30
3     10         1         10.1    1   Sample 1                12/23/2016 05:15
4     10         1         10.1    2   Sample 2                12/24/2016 18:00
5     10         1         10.1    3   Sample 3                12/25/2016 03:00
6     10         1         10.1    4   Sample 4                12/26/2016 04:00</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>samp.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"samp_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># drug concentration measurements</span>
<span class='va'>conc.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>conc.in</span>, <span class='va'>id.xwalk</span>,
    firstCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'record_id'</span>, <span class='st'>'mod_id'</span>, <span class='st'>'mod_visit'</span>, <span class='st'>'mod_id_visit'</span>, <span class='st'>'samp'</span><span class='op'>)</span>,
    orderBy <span class='op'>=</span> <span class='st'>'record_id'</span>,
    uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>conc.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  record_id mod_id mod_visit mod_id_visit samp fentanyl_calc_conc
1         1      1         2          1.2    1         0.01413622
2         2      1         2          1.2    2         0.27982075
3         3      2         1          2.1    1         6.11873679
4         4      2         1          2.1    2         0.59161716
5         5      2         1          2.1    3         0.11280471
6         6      2         1          2.1    4         0.02112153</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>conc.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"conc_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## dosing data</span>
<span class='co'># flow</span>
<span class='va'>flow.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>flow.in</span>, <span class='va'>id.xwalk</span>,
    firstCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>, <span class='st'>'mod_visit'</span>, <span class='st'>'mod_id_visit'</span><span class='op'>)</span>,
    uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>flow.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id mod_visit mod_id_visit     Perform.Date FOCUS_MEDNAME Final.Wt..kg. Final.Rate..NFR.units. Final.Units Flow           date.time
1      9         1          9.1   12/4/2016 5:30      Fentanyl          6.75            1 mcg/kg/hr       3.375   NA 2016-12-04 05:30:00
2      9         1          9.1   12/4/2016 6:00      Fentanyl          6.75            1 mcg/kg/hr       6.750  0.1 2016-12-04 06:00:00
3      9         1          9.1   12/4/2016 7:00      Fentanyl          6.75            1 mcg/kg/hr       4.500  0.1 2016-12-04 07:00:00
4      9         1          9.1   12/4/2016 7:40      Fentanyl          6.75            0 mcg/kg/hr       0.000   NA 2016-12-04 07:40:00
5     10         1         10.1 12/24/2016 19:30      Fentanyl          2.60            2 mcg/kg/hr       2.600   NA 2016-12-24 19:30:00
6     10         1         10.1 12/24/2016 20:00      Fentanyl          2.60            2 mcg/kg/hr       5.200  0.2 2016-12-24 20:00:00
       unit rate
1 mcg/kg/hr    1
2 mcg/kg/hr    1
3 mcg/kg/hr    1
4 mcg/kg/hr    0
5 mcg/kg/hr    2
6 mcg/kg/hr    2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>flow.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"flow_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># mar</span>
<span class='va'>mar.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>mar.in</span>, <span class='va'>id.xwalk</span>, firstCols <span class='op'>=</span> <span class='st'>'mod_id'</span>, uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>mar.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id       Date  Time                 med:mDrug   med:dosage med:route med:freq med:given
1      1 2017-02-04 19:15               Nicardipine 3 mcg/kg/min        IV     &lt;NA&gt;     Given
2      1 2011-10-02 22:11                Famotidine       4.5 mg        IV   q12hrs     Given
3      1 2011-10-02 20:17          Morphine sulfate         1 mg        IV  q2h prn     Given
4      1 2011-10-03 02:28 Diphenhydramine injection        12 mg        IV      now     Given
5      1 2011-10-02 22:11                 Cefazolin       225 mg        IV    q8hrs     Given
6      1 2011-10-02 23:30          Morphine sulfate         1 mg        IV  q2h prn     Given</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>mar.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"mar_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## laboratory data</span>
<span class='co'># creatinine</span>
<span class='va'>creat.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>creat.in</span>, <span class='va'>id.xwalk</span>, <span class='st'>'mod_id'</span>,uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>creat.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id     date time creat
1      1 02/05/17 4:00  0.52
2      1 02/06/17 5:00  0.53
3      1 10/03/11 4:28  0.42
4      1 10/04/11 4:15  0.35
5      1 10/06/11 4:25  0.29
6      1 10/09/11 4:45  0.28</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>creat.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"creat_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># albumin</span>
<span class='va'>alb.cln</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullFakeId.html'>pullFakeId</a></span><span class='op'>(</span><span class='va'>alb.in</span>, <span class='va'>id.xwalk</span>, <span class='st'>'mod_id'</span>, uniq.id <span class='op'>=</span> <span class='st'>'subject_uid'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>alb.cln</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id     date  time alb
1      8 07/30/20  5:23 2.9
2      8 07/28/20  3:12 2.0
3      8 07/29/20  1:39 2.7
4      8 08/21/20 10:35 4.1
5      4 06/13/15 17:20 4.1
6      6 07/25/16  8:35 2.3</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>alb.cln</span>, file<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"alb_mod_id.rds"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><strong>Options and parameters</strong>: Before running the processing modules, it is necessary to define several options and parameters.</p>
<ul>
<li>Using <code>options(pkxwalk =)</code> allows the modules to access the crosswalk file.</li>
<li>Create a <code>drugname</code> stub.</li>
<li>Define the lower limit of quantification (LLOQ) for the drug concentration if applicable.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># set crosswalk option </span>
<span class='va'>xwalk</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>, <span class='st'>"module_id_xwalk.rds"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>pkxwalk <span class='op'>=</span> <span class='st'>'xwalk'</span><span class='op'>)</span>

<span class='co'># define parameters</span>
<span class='va'>drugname</span> <span class='op'>&lt;-</span> <span class='st'>'fent'</span>
<span class='va'>LLOQ</span> <span class='op'>&lt;-</span> <span class='fl'>0.05</span>
</code></pre>
</div>
</div>
<h1 id="pro-demographic">Pro-Demographic</h1>
<ul>
<li>This module accepts the cleaned structured demographic dataset and a user-defined set of exclusion criteria and returns a formatted list with the demographic data and records meeting the exclusion criteria suitable for integration with the other modules.</li>
<li>For this example, we exclude subjects with a value of 1 for <code>in_hospital_mortality</code> or <code>add_ecmo</code> and create a new variable called <code>length_of_icu_stay</code>.</li>
<li><strong><code>run_Demo()</code></strong> is the function to run this module.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># helper function</span>
<span class='va'>exclude_val</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>val</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>x</span> <span class='op'>==</span> <span class='va'>val</span> <span class='op'>}</span>

<span class='va'>demo.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_Demo.html'>run_Demo</a></span><span class='op'>(</span>demo.path <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>, <span class='st'>"demo_mod_id.rds"</span><span class='op'>)</span>,
    toexclude <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'>exclude_val</span><span class='op'>(</span><span class='va'>in_hospital_mortality</span><span class='op'>)</span> <span class='op'>|</span> <span class='fu'>exclude_val</span><span class='op'>(</span><span class='va'>add_ecmo</span><span class='op'>)</span><span class='op'>)</span>,
    demo.mod.list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>length_of_icu_stay <span class='op'>=</span> 
                        <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pk-internal.html'>daysDiff</a></span><span class='op'>(</span><span class='va'>surgery_date</span>, <span class='va'>date_icu_dc</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>The number of subjects in the demographic data, who meet the exclusion criteria: 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>demo.out</span><span class='op'>$</span><span class='va'>demo</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id mod_visit mod_id_visit gender weight height surgery_date ageatsurgery stat_sts cpb_sts in_hospital_mortality add_ecmo date_icu_dc
1      2         1          2.1      0   5.14  59.18    6/28/2014          141        3     133                     0        0    7/2/2014
2      3         1          3.1      1   5.67  62.90    1/10/2016          292        1      65                     0        0   1/12/2016
3      4         1          4.1      0  23.67 118.02    3/19/2016         2591        2     357                     0        0   3/20/2016
4      5         1          5.1      0  14.07  97.04    7/18/2016         1320        5      93                     0        0   7/19/2016
5      6         1          6.1      1  23.40 102.80    7/23/2016         1561        3      87                     1        0   7/30/2016
6      7         1          7.1      1   6.21  62.03     9/4/2016          208        1     203                     0        0   9/11/2016
  time_fromor length_of_icu_stay
1        1657                  4
2        1325                  2
3          NA                  1
4        1745                  1
5        1847                  7
6        1210                  7</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>demo.out</span><span class='op'>$</span><span class='va'>exclude</span>
</code></pre>
</div>
<pre><code>[1] &quot;6.1&quot;  &quot;13.1&quot;</code></pre>
</div>
<h1 id="pro-med-str-part-i-iv-dose-data">Pro-Med-Str Part I: IV dose data</h1>
<ul>
<li>This module processes structured medication data. Only Part I which handles IV dose data is described here. For processing structure e-prescription medication data, see <a href="Pro-Med-Str-Part2.html"><em>Pro-Med-Str</em> - Part II</a>.</li>
<li>The IV dose data comes from two sources:
<ul>
<li>Flow data: patient flow sheets which at this institution record infusion rates and changes to all infusions for all inpatients outside of the operating room.</li>
<li>Medication Administration Records (MAR) data: This data record all bolus doses of medications and infusions administered in the operating room.</li>
</ul></li>
<li>The module is semi-interactive – it generates several files to check potential data errors and get feedback from an investigator. If corrected information (‘fix’ files) are provided, the module should be re-run to incorporate the corrections.</li>
<li><strong>run_MedStrI()</strong> is the function to process IV dose data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ivdose.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_MedStrI.html'>run_MedStrI</a></span><span class='op'>(</span>
    mar.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"mar_mod_id.rds"</span><span class='op'>)</span>,
    mar.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id<span class='op'>=</span><span class='st'>'mod_id'</span>, datetime<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Date'</span>,<span class='st'>'Time'</span><span class='op'>)</span>, dose<span class='op'>=</span><span class='st'>'med:dosage'</span>, drug<span class='op'>=</span><span class='st'>'med:mDrug'</span>, given<span class='op'>=</span><span class='st'>'med:given'</span><span class='op'>)</span>,
    medGivenReq <span class='op'>=</span> <span class='cn'>TRUE</span>,
    flow.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"flow_mod_id.rds"</span><span class='op'>)</span>,
    flow.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>'mod_id'</span>, datetime <span class='op'>=</span> <span class='st'>'date.time'</span>, finalunits <span class='op'>=</span> <span class='st'>'Final.Units'</span>, 
                        unit <span class='op'>=</span> <span class='st'>'unit'</span>, rate <span class='op'>=</span> <span class='st'>'rate'</span>, weight <span class='op'>=</span> <span class='st'>'Final.Wt..kg.'</span><span class='op'>)</span>,
    medchk.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"examples"</span>, <span class='st'>"str_ex2"</span>, package<span class='op'>=</span><span class='st'>"EHR"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'medChecked-%s.csv'</span>, <span class='va'>drugname</span><span class='op'>)</span><span class='op'>)</span>,
    demo.list <span class='op'>=</span> <span class='cn'>NULL</span>,
    demo.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
    missing.wgt.path <span class='op'>=</span> <span class='cn'>NULL</span>,
    wgt.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
    check.path <span class='op'>=</span> <span class='va'>checkDir</span>,
    failflow_fn <span class='op'>=</span> <span class='st'>'FailFlow'</span>,
    failunit_fn <span class='op'>=</span> <span class='st'>'Unit'</span>,
    failnowgt_fn <span class='op'>=</span> <span class='st'>'NoWgt'</span>,
    infusion.unit <span class='op'>=</span> <span class='st'>'mcg/kg/hr'</span>,
    bolus.unit <span class='op'>=</span> <span class='st'>'mcg'</span>,
    bol.rate.thresh <span class='op'>=</span> <span class='cn'>Inf</span>,
    rateunit <span class='op'>=</span> <span class='st'>'mcg/hr'</span>,
    ratewgtunit <span class='op'>=</span> <span class='st'>'mcg/kg/hr'</span>,
    weightunit <span class='op'>=</span> <span class='st'>'kg'</span>,
    drugname <span class='op'>=</span> <span class='va'>drugname</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>The number of rows in the original data                124
The number of rows after removing the duplicates       124
no units other than mcg/kg/hr or mcg, file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/failUnit-fent.csv not created
#########################
33 rows from 1 subjects with &quot;kg&quot; in infusion unit but missing weight, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/failNoWgt-fent.csv AND create /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/fixNoWgt-fent.csv
#########################</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>ivdose.out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mod_id  date.dose infuse.time.real infuse.time infuse.dose          bolus.time bolus.dose given.dose maxint weight
1      1 2011-10-02             &lt;NA&gt;        &lt;NA&gt;          NA 2011-10-02 15:35:00         25         NA      0     NA
2      1 2011-10-02             &lt;NA&gt;        &lt;NA&gt;          NA 2011-10-02 17:26:00         25         NA      0     NA
3      1 2017-02-04             &lt;NA&gt;        &lt;NA&gt;          NA 2017-02-04 16:15:00         50         NA      0     NA
4      1 2017-02-04             &lt;NA&gt;        &lt;NA&gt;          NA 2017-02-04 16:30:00         20         NA      0     NA
5      1 2017-02-04             &lt;NA&gt;        &lt;NA&gt;          NA 2017-02-04 20:57:00         20         NA      0     NA
6      2 2014-06-28             &lt;NA&gt;        &lt;NA&gt;          NA 2014-06-28 08:15:00         20         NA      0     NA</code></pre>
</div>
<h1 id="pro-drug-level">Pro-Drug Level</h1>
<ul>
<li>This module processes drug concentration data that can be merged with medication dose data and other types of data.</li>
<li>This module is semi-interactive – it generates several files while processing in order to check missing data and potential data errors, and get feedback from an investigator. If corrected information (‘fix’ files) are provided, the module should be re-run to incorporate the corrections.</li>
<li><strong>run_DrugLevel</strong> is the function to process the drug concentration data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>conc.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_DrugLevel.html'>run_DrugLevel</a></span><span class='op'>(</span>conc.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"conc_mod_id.rds"</span><span class='op'>)</span>,
    conc.select<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>,<span class='st'>'mod_id_visit'</span>,<span class='st'>'samp'</span>,<span class='st'>'fentanyl_calc_conc'</span><span class='op'>)</span>,
    conc.rename<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>fentanyl_calc_conc <span class='op'>=</span> <span class='st'>'conc.level'</span>, samp<span class='op'>=</span> <span class='st'>'event'</span><span class='op'>)</span>,
    conc.mod.list<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mod_id_event <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>mod_id_visit</span>, <span class='va'>event</span>, sep <span class='op'>=</span> <span class='st'>'_'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    samp.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"samp_mod_id.rds"</span><span class='op'>)</span>,
    samp.mod.list<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mod_id_event <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>mod_id_visit</span>, <span class='va'>samp</span>, sep <span class='op'>=</span> <span class='st'>'_'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    check.path<span class='op'>=</span><span class='va'>checkDir</span>,
    failmiss_fn <span class='op'>=</span> <span class='st'>'MissingConcDate-'</span>,
    multsets_fn <span class='op'>=</span> <span class='st'>'multipleSetsConc-'</span>,
    faildup_fn <span class='op'>=</span> <span class='st'>'DuplicateConc-'</span>, 
    drugname<span class='op'>=</span><span class='va'>drugname</span>,
    LLOQ<span class='op'>=</span><span class='va'>LLOQ</span>,
    demo.list<span class='op'>=</span><span class='va'>demo.out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>#########################
3 rows need review, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/failMissingConcDate-fent.csv AND create /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/fixMissingConcDate-fent.csv
#########################
subjects with concentration missing from sample file
 mod_id mod_id_event
      8        8.1_1
      8        8.1_2
      8        8.1_3
1 subjects have multiple sets of concentration data
16 total unique subjects ids (including multiple visits) currently in the concentration data
15 total unique subjects in the concentration data
#########################
15 rows need review, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/multipleSetsConc-fent2021-10-05.csv
#########################
15 total unique subjects ids (after excluding multiple visits) in the concentration data
15 total unique subjects in the concentration data</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>conc.out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   mod_id mod_id_visit event  conc.level mod_id_event           date.time eid
1       1          1.2     1 0.014136220        1.2_1 2017-02-03 10:46:00   1
2       1          1.2     2 0.279820752        1.2_2 2017-02-04 20:30:00   1
55     10         10.1     2 3.136047304       10.1_2 2016-12-24 18:00:00   1
56     10         10.1     9 0.004720171       10.1_9 2017-01-01 04:20:00   1
57     10         10.1    10 0.017136367      10.1_10 2017-01-02 04:42:00   1
58     10         10.1    12 0.006335571      10.1_12 2017-01-04 03:40:00   1</code></pre>
</div>
<ul>
<li>The output provides a message that 3 rows are missing concentration date. The file ‘failMissingConcDate-fent.csv’ contains the 3 records with missing values for the <code>date.time</code> variable.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span> <span class='va'>fail.miss.conc.date</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>checkDir</span>,<span class='st'>"failMissingConcDate-fent.csv"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>)</span>
</code></pre>
</div>
<pre><code>  subject_id subject_uid mod_id_event date.time
1       1566    35885929        8.1_1        NA
2       1566    35885929        8.1_2        NA
3       1566    35885929        8.1_3        NA</code></pre>
</div>
<ul>
<li>We can correct the missing dates by providing an updated file called ‘fixMissingConcDate-fent.csv’ that contains the missing data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fail.miss.conc.date</span><span class='op'>[</span>,<span class='st'>"date.time"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9/30/2016 09:32"</span>,<span class='st'>"10/1/2016 19:20"</span>,<span class='st'>"10/2/2016 02:04"</span><span class='op'>)</span>
<span class='va'>fail.miss.conc.date</span>
</code></pre>
</div>
<pre><code>  subject_id subject_uid mod_id_event       date.time
1       1566    35885929        8.1_1 9/30/2016 09:32
2       1566    35885929        8.1_2 10/1/2016 19:20
3       1566    35885929        8.1_3 10/2/2016 02:04</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='va'>fail.miss.conc.date</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>checkDir</span>,<span class='st'>"fixMissingConcDate-fent.csv"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>After providing the updated file, the same <code>run_DrugLevel()</code> function should be re-run. The output now contains an additional message below the first message saying “fixMissingConcDate-fent.csv read with failures replaced”. The conc.out data.frame also contains 3 additional rows with the corrected data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>conc.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_DrugLevel.html'>run_DrugLevel</a></span><span class='op'>(</span>conc.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"conc_mod_id.rds"</span><span class='op'>)</span>,
    conc.select<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>,<span class='st'>'mod_id_visit'</span>,<span class='st'>'samp'</span>,<span class='st'>'fentanyl_calc_conc'</span><span class='op'>)</span>,
    conc.rename<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>fentanyl_calc_conc <span class='op'>=</span> <span class='st'>'conc.level'</span>, samp<span class='op'>=</span> <span class='st'>'event'</span><span class='op'>)</span>,
    conc.mod.list<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mod_id_event <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>mod_id_visit</span>, <span class='va'>event</span>, sep <span class='op'>=</span> <span class='st'>'_'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    samp.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"samp_mod_id.rds"</span><span class='op'>)</span>,
    samp.mod.list<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mod_id_event <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>mod_id_visit</span>, <span class='va'>samp</span>, sep <span class='op'>=</span> <span class='st'>'_'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    check.path<span class='op'>=</span><span class='va'>checkDir</span>,
    failmiss_fn <span class='op'>=</span> <span class='st'>'MissingConcDate-'</span>,
    multsets_fn <span class='op'>=</span> <span class='st'>'multipleSetsConc-'</span>,
    faildup_fn <span class='op'>=</span> <span class='st'>'DuplicateConc-'</span>, 
    drugname<span class='op'>=</span><span class='va'>drugname</span>,
    LLOQ<span class='op'>=</span><span class='va'>LLOQ</span>,
    demo.list<span class='op'>=</span><span class='va'>demo.out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>#########################
3 rows need review, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/failMissingConcDate-fent.csv AND create /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/fixMissingConcDate-fent.csv
#########################
file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/fixMissingConcDate-fent.csv read with failures replaced
subjects with concentration missing from sample file
[1] mod_id       mod_id_event
&lt;0 rows&gt; (or 0-length row.names)
1 subjects have multiple sets of concentration data
16 total unique subjects ids (including multiple visits) currently in the concentration data
15 total unique subjects in the concentration data
#########################
15 rows need review, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/multipleSetsConc-fent2021-10-05.csv
#########################
15 total unique subjects ids (after excluding multiple visits) in the concentration data
15 total unique subjects in the concentration data</code></pre>
</div>
<h1 id="pro-laboratory">Pro-Laboratory</h1>
<ul>
<li>This module processes laboratory data that can be merged with data from other modules.</li>
<li><strong>run_Labs()</strong> is the function to process the laboratory data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>creat.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_Labs.html'>run_Labs</a></span><span class='op'>(</span>lab.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"creat_mod_id.rds"</span><span class='op'>)</span>,
    lab.select <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>,<span class='st'>'date.time'</span>,<span class='st'>'creat'</span><span class='op'>)</span>,
    lab.mod.list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>date.time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/pkdata/man/parse_dates.html'>parse_dates</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pk-internal.html'>fixDates</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>time</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>alb.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_Labs.html'>run_Labs</a></span><span class='op'>(</span>lab.path<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dataDir</span>,<span class='st'>"alb_mod_id.rds"</span><span class='op'>)</span>,
    lab.select <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'mod_id'</span>,<span class='st'>'date.time'</span>,<span class='st'>'alb'</span><span class='op'>)</span>,
    lab.mod.list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>date.time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/pkdata/man/parse_dates.html'>parse_dates</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pk-internal.html'>fixDates</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>time</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>lab.out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>creat.out</span>, <span class='va'>alb.out</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>lab.out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>List of 2
 $ :&#39;data.frame&#39;:   266 obs. of  3 variables:
  ..$ mod_id   : int [1:266] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ date.time: POSIXct[1:266], format: &quot;2017-02-05 04:00:00&quot; &quot;2017-02-06 05:00:00&quot; &quot;2011-10-03 04:28:00&quot; &quot;2011-10-04 04:15:00&quot; ...
  ..$ creat    : num [1:266] 0.52 0.53 0.42 0.35 0.29 0.28 0.34 0.59 0.54 0.26 ...
 $ :&#39;data.frame&#39;:   44 obs. of  3 variables:
  ..$ mod_id   : int [1:44] 8 8 8 8 4 6 6 9 10 10 ...
  ..$ date.time: POSIXct[1:44], format: &quot;2020-07-30 05:23:00&quot; &quot;2020-07-28 03:12:00&quot; &quot;2020-07-29 01:39:00&quot; &quot;2020-08-21 10:35:00&quot; ...
  ..$ alb      : num [1:44] 2.9 2 2.7 4.1 4.1 2.3 2.6 3 3.1 4.2 ...</code></pre>
</div>
<h1 id="build-pk-iv">Build-PK-IV</h1>
<ul>
<li>This module creates PK data for IV medications.</li>
<li>Both dose data in the format output from the <em>Pro-Med-Str1</em> module and concentration data in the format output from the <em>Pro-DrugLevel</em> module are required.</li>
<li>Demographic data from the <em>Pro-Demographic</em> module and laboratory data from the <em>Pro-Laboratory</em> module are optional.</li>
<li>The module is semi-interactive – it generates several files to check potential data errors, and get feedback from an investigator. If corrected information (‘fix’ files) are provided, the module should be re-run to incorporate the corrections.</li>
<li>If <code>pk.vars</code> includes ‘date’, the output generates its original date-time to which the ‘time’ is mapped. Users can use <code>pk.vars</code> to include variables for demographics or labs that are already merged with the concentration dataset when they prefer to provide a single concentration data file (required). But a separate dose data file is still required.</li>
<li><strong>run_Build_PK_IV()</strong> is the function to build PK data with IV dosing data.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pk_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/run_Build_PK_IV.html'>run_Build_PK_IV</a></span><span class='op'>(</span>
    conc<span class='op'>=</span><span class='va'>conc.out</span>,
    conc.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>'mod_id'</span>, datetime <span class='op'>=</span> <span class='st'>'date.time'</span>, druglevel <span class='op'>=</span> <span class='st'>'conc.level'</span>, 
                        idvisit <span class='op'>=</span> <span class='st'>'mod_id_visit'</span><span class='op'>)</span>,
    dose<span class='op'>=</span><span class='va'>ivdose.out</span>,
    dose.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>'mod_id'</span>, date <span class='op'>=</span> <span class='st'>'date.dose'</span>, infuseDatetime <span class='op'>=</span> <span class='st'>'infuse.time'</span>, 
                        infuseDose <span class='op'>=</span> <span class='st'>'infuse.dose'</span>, infuseTimeExact<span class='op'>=</span> <span class='st'>'infuse.time.real'</span>,
                        bolusDatetime <span class='op'>=</span> <span class='st'>'bolus.time'</span>, bolusDose <span class='op'>=</span> <span class='st'>'bolus.dose'</span>, 
                        gap <span class='op'>=</span> <span class='st'>'maxint'</span>, weight <span class='op'>=</span> <span class='st'>'weight'</span><span class='op'>)</span>,
    demo.list <span class='op'>=</span> <span class='va'>demo.out</span>,
    demo.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>'mod_id'</span>, idvisit <span class='op'>=</span> <span class='st'>'mod_id_visit'</span><span class='op'>)</span>,
    lab.list <span class='op'>=</span> <span class='va'>lab.out</span>,
    lab.columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>'mod_id'</span>, datetime <span class='op'>=</span> <span class='st'>'date.time'</span><span class='op'>)</span>,
    pk.vars<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'date'</span><span class='op'>)</span>,
    drugname<span class='op'>=</span><span class='va'>drugname</span>,
    check.path<span class='op'>=</span><span class='va'>checkDir</span>,
    missdemo_fn<span class='op'>=</span><span class='st'>'-missing-demo'</span>,
    faildupbol_fn<span class='op'>=</span><span class='st'>'DuplicateBolus-'</span>,
    date.format<span class='op'>=</span><span class='st'>"%m/%d/%y %H:%M:%S"</span>,
    date.tz<span class='op'>=</span><span class='st'>"America/Chicago"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>0 duplicated rows
The dimension of the PK data before merging with demographics: 234 x 9
The number of subjects in the PK data before merging with demographics: 15
The number of subjects in the demographic file, who meet the exclusion criteria: 2
check NA frequency in demographics, see file /var/folders/06/0qv1dr5508j_tbzqdjfqjf680000gn/T//RtmpeD306a/checks/fent-missing-demo.csv
Some demographic variables are missing and will be excluded: 
The list of final demographic variables: mod_visit
gender
weight
height
surgery_date
ageatsurgery
stat_sts
cpb_sts
in_hospital_mortality
add_ecmo
date_icu_dc
time_fromor
length_of_icu_stay
weight_demo
Checked: there are no missing creat
List of IDs missing at least 1 alb: 1.2
11.1
15.1
2.1
3.1
4.1
5.1
7.1
8.1
Some PK variables are missing and will be excluded: 
The dimension of the final PK data exported with the key demographics: 197 x 24 with 13 distinct subjects (mod_id)</code></pre>
</div>
<ul>
<li><strong>Retrieving the original IDs</strong>:
<ul>
<li>The function <code>pullRealId()</code> appends the original IDs – <code>subject_id</code> and <code>subject_uid</code> to the data.</li>
<li>The parameter <code>remove.mod.id=TRUE</code> can be used to also remove any module IDs – <code>mod_id</code>, <code>mod_visit</code>, and <code>mod_id_visit</code>.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># convert id back to original IDs</span>
<span class='va'>pk_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EHR/man/pullRealId.html'>pullRealId</a></span><span class='op'>(</span><span class='va'>pk_dat</span>, remove.mod.id<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>pk_dat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     subject_id subject_uid time   amt        dv rate mdv evid              date gender weight height surgery_date ageatsurgery stat_sts
2         466.1    28579217 0.00  50.0        NA  0.0   1    1 02/04/17 16:15:00      0  21.99 116.90     2/4/2017         2451        1
2.1       466.1    28579217 0.25  20.0        NA  0.0   1    1 02/04/17 16:30:00      0  21.99 116.90     2/4/2017         2451        1
2.2       466.1    28579217 4.25    NA 0.2798208   NA   0    0 02/04/17 20:30:00      0  21.99 116.90     2/4/2017         2451        1
12       1607.0    38551767 0.00 109.2        NA 10.4   1    1 12/24/16 07:15:00      0   2.60  45.94   12/24/2016           23        3
12.1     1607.0    38551767 0.00  10.0        NA  0.0   1    1 12/24/16 07:15:00      0   2.60  45.94   12/24/2016           23        3
12.2     1607.0    38551767 1.25  15.0        NA  0.0   1    1 12/24/16 08:30:00      0   2.60  45.94   12/24/2016           23        3
     cpb_sts in_hospital_mortality add_ecmo date_icu_dc time_fromor length_of_icu_stay weight_demo creat alb
2        107                     0        0    2/5/2017        1322                  1       21.99  0.54  NA
2.1      107                     0        0    2/5/2017        1322                  1       21.99  0.54  NA
2.2      107                     0        0    2/5/2017        1322                  1       21.99  0.54  NA
12       110                     0        0    1/5/2017          NA                 12        2.76  0.66 1.6
12.1     110                     0        0    1/5/2017          NA                 12        2.76  0.66 1.6
12.2     110                     0        0    1/5/2017          NA                 12        2.76  0.66 1.6</code></pre>
</div>
<h1 id="references">References</h1>
<ol type="1">
<li>Choi L, Beck C, McNeer E, Weeks HL, Williams ML, James NT, Niu X, Abou-Khalil BW, Birdwell KA, Roden DM, Stein CM. Development of a System for Post-marketing Population Pharmacokinetic and Pharmacodynamic Studies using Real-World Data from Electronic Health Records. Clinical Pharmacology &amp; Therapeutics. 2020 Apr;107(4):934-43. doi: 10.1002/cpt.1787.</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/choileena/choileena.github.io/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
